import{c as x,u as K,r as o,j as e,a as g,f as p,m as $,g as M,S as X,G as Y,Z as q,l as N}from"./index-DOv-VC2m.js";import{c as ee}from"./sanitize-uP-gIDZP.js";import{S as se}from"./square-check-big-CvxN2Bvx.js";import{C as I}from"./chevron-down-BuKz14xV.js";import{F as ae}from"./flag-CyhJ0Emc.js";import{E as B}from"./eye-CQmJmb7b.js";const ie=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],te=x("arrow-up-down",ie);const ne=[["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M14 7a4 4 0 0 1 4 4v3a6 6 0 0 1-12 0v-3a4 4 0 0 1 4-4z",key:"uouzyp"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M21 21a4 4 0 0 0-3.81-4",key:"1b0z45"}],["path",{d:"M21 5a4 4 0 0 1-3.55 3.97",key:"5cxbf6"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M3 21a4 4 0 0 1 3.81-4",key:"1fjd4g"}],["path",{d:"M3 5a4 4 0 0 0 3.55 3.97",key:"1d7oge"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M9 7.13V6a3 3 0 1 1 6 0v1.13",key:"1vgav8"}]],re=x("bug",ne);const le=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],E=x("message-square",le);const ce=[["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}],["path",{d:"M17 14V2",key:"8ymqnk"}]],de=x("thumbs-down",ce);const oe=[["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}],["path",{d:"M7 10v12",key:"1qc93n"}]],G=x("thumbs-up",oe),he=[{id:"REQ-001",title:"User shall be able to record up to 200 hours of content",risk:"low",status:"approved",gaps:0,comments:3,testability:95,complexity:"low",untestedBranches:1,edgeCases:3,historicalDefects:2,aiSummary:"Well-defined with clear acceptance criteria",gapDetails:[]},{id:"REQ-002",title:"CDVR playback shall support trick-play operations",risk:"medium",status:"review",gaps:2,comments:5,testability:78,complexity:"medium",untestedBranches:4,edgeCases:8,historicalDefects:5,aiSummary:"Missing DRM key rotation and buffering edge cases",gapDetails:["No test for DRM key rotation during trick-play","Buffering behavior during fast-forward undefined"]},{id:"REQ-003",title:"System shall handle concurrent recording conflicts gracefully",risk:"high",status:"flagged",gaps:4,comments:8,testability:45,complexity:"high",untestedBranches:7,edgeCases:12,historicalDefects:11,aiSummary:"Missing concurrency edge cases and conflict priority rules",gapDetails:["No max concurrent recording limit defined per tier","Conflict resolution priority rules missing","No test for simultaneous schedule + cancel","Storage impact during conflicts undefined"]},{id:"REQ-004",title:"Recording schedule shall sync across all user devices",risk:"medium",status:"review",gaps:1,comments:2,testability:82,complexity:"medium",untestedBranches:3,edgeCases:6,historicalDefects:4,aiSummary:"Network failure during sync not addressed",gapDetails:["No offline sync recovery scenario"]},{id:"REQ-005",title:"Parental controls shall apply to recorded content",risk:"low",status:"approved",gaps:0,comments:1,testability:90,complexity:"low",untestedBranches:1,edgeCases:4,historicalDefects:1,aiSummary:"Comprehensive coverage with clear PIN flow",gapDetails:[]},{id:"REQ-006",title:"Storage quota notifications at 80% and 95% thresholds",risk:"low",status:"review",gaps:1,comments:4,testability:88,complexity:"low",untestedBranches:2,edgeCases:5,historicalDefects:3,aiSummary:"Missing notification dismissal and snooze behavior",gapDetails:["Notification snooze/dismiss behavior undefined"]}],k=[{category:"UI",coverage:78,angle:0},{category:"Backend",coverage:62,angle:60},{category:"Edge Cases",coverage:35,angle:120},{category:"Security",coverage:28,angle:180},{category:"Integration",coverage:55,angle:240},{category:"Performance",coverage:42,angle:300}];function je(){const t=K(),[y,P]=o.useState("all"),[w,S]=o.useState(null),[c,h]=o.useState([]),[j,T]=o.useState(null),[v,_]=o.useState(null),[m,b]=o.useState(null),[d,A]=o.useState(he),[C,D]=o.useState(!1),z=y==="all"?d:d.filter(s=>s.status===y),O=[...z].sort((s,a)=>m==="coverage-asc"?s.testability-a.testability:m==="coverage-desc"?a.testability-s.testability:0),W=s=>s==="high"?"danger":s==="medium"?"warning":"success",l=d.find(s=>s.id===w),J=s=>h(a=>a.includes(s)?a.filter(i=>i!==s):[...a,s]),F=()=>h(z.map(s=>s.id)),Q=()=>h([]),U=()=>{b(m?m==="coverage-asc"?"coverage-desc":null:"coverage-asc")},H=async()=>{D(!0),t.info("AI is analyzing requirements for gaps...");try{const s=d.map(i=>({id:i.id,title:i.title,testability:i.testability,gaps:i.gaps})),a=await N("Analyze these requirements for coverage gaps, missing edge cases, and risk areas. For each requirement, provide an updated aiSummary and any new gapDetails. Return JSON array with fields: id, aiSummary, gapDetails (array of strings), risk (low/medium/high). Only return the JSON array.",JSON.stringify(s));try{const i=JSON.parse(a.reply.replace(/```json\s*/g,"").replace(/```\s*/g,"").trim());Array.isArray(i)&&(A(u=>u.map(n=>{const r=i.find(f=>f.id===n.id);return r?{...n,aiSummary:r.aiSummary||n.aiSummary,gapDetails:r.gapDetails||n.gapDetails,risk:r.risk||n.risk,gaps:(r.gapDetails||n.gapDetails).length}:n})),t.success("AI gap analysis complete — summaries updated"))}catch{t.info(`AI analysis: ${a.reply.substring(0,150)}...`)}}catch(s){t.error(`AI gap analysis failed: ${s.message}`)}finally{D(!1)}},V=async()=>{t.info(`Re-generating AI analysis for ${c.length} requirement(s)...`);try{const s=d.filter(i=>c.includes(i.id)),a=await N("Re-analyze these requirements and provide updated scores. Return JSON array with: id, testability (0-100), aiSummary, gapDetails (array), risk (low/medium/high). Only return JSON.",JSON.stringify(s.map(i=>({id:i.id,title:i.title}))));try{const i=JSON.parse(a.reply.replace(/```json\s*/g,"").replace(/```\s*/g,"").trim());Array.isArray(i)&&(A(u=>u.map(n=>{const r=i.find(f=>f.id===n.id);return r?{...n,testability:r.testability||n.testability,aiSummary:r.aiSummary||n.aiSummary,gapDetails:r.gapDetails||n.gapDetails,risk:r.risk||n.risk,gaps:(r.gapDetails||n.gapDetails).length}:n})),t.success(`AI re-analysis complete for ${c.length} requirement(s)`))}catch{t.info("AI provided analysis in text format")}}catch(s){t.error(`Re-generate failed: ${s.message}`)}h([])},L=async s=>{t.info(`AI generating ${s.gaps} missing scenarios for ${s.id}...`);try{const a=await N(`Generate ${s.gaps} missing test scenarios for this requirement. Focus on the gaps identified. Return a brief list of scenario titles and descriptions.`,`Requirement: ${s.id} - ${s.title}
Gaps: ${s.gapDetails.join(", ")}
Risk: ${s.risk}`);t.success(`AI suggestions for ${s.id}: ${a.reply.substring(0,200)}`)}catch(a){t.error(`Bridge gap failed: ${a.message}`)}},R=k.map(s=>{const a=s.coverage/100*40,i=(s.angle-90)*Math.PI/180;return{...s,cx:50+a*Math.cos(i),cy:50+a*Math.sin(i)}}),Z=R.map((s,a)=>`${a===0?"M":"L"}${s.cx},${s.cy}`).join(" ")+"Z";return e.jsxs("div",{className:"review-dashboard",children:[e.jsxs("section",{className:"grid-4",style:{marginBottom:"1.5rem"},children:[e.jsxs("div",{className:"card stat-card",children:[e.jsx("div",{className:"stat-value animate-count",children:d.length}),e.jsx("div",{className:"stat-label",children:"Total Requirements"})]}),e.jsxs("div",{className:"card stat-card",children:[e.jsx("div",{className:"stat-value animate-count",style:{color:"var(--success)"},children:d.filter(s=>s.status==="approved").length}),e.jsx("div",{className:"stat-label",children:"Approved"})]}),e.jsxs("div",{className:"card stat-card",children:[e.jsx("div",{className:"stat-value animate-count",style:{color:"var(--warning)"},children:d.filter(s=>s.status==="review").length}),e.jsx("div",{className:"stat-label",children:"In Review"})]}),e.jsxs("div",{className:"card stat-card",children:[e.jsx("div",{className:"stat-value animate-count",style:{color:"var(--danger)"},children:d.filter(s=>s.status==="flagged").length}),e.jsx("div",{className:"stat-label",children:"Flagged"})]})]}),e.jsxs("div",{className:"review-layout",children:[e.jsxs("section",{className:"card review-list-panel",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{className:"card-title",children:"Requirements Review"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[c.length>0&&e.jsxs("div",{className:"batch-actions animate-in",children:[e.jsxs("span",{className:"badge badge-accent",children:[c.length," selected"]}),e.jsxs("button",{className:"btn btn-sm btn-success",onClick:()=>{t.success(`${c.length} requirement(s) approved`),h([])},children:[e.jsx(G,{size:12})," Approve"]}),e.jsxs("button",{className:"btn btn-sm btn-secondary",onClick:()=>{t.info(`Clarification requested for ${c.length} requirement(s)`),h([])},children:[e.jsx(E,{size:12})," Request Clarification"]}),e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:V,children:[e.jsx(g,{size:12})," Re-generate"]}),e.jsx("button",{className:"btn btn-sm btn-secondary",onClick:Q,children:"Clear"})]}),e.jsxs("button",{className:"btn btn-sm btn-secondary",onClick:F,children:[e.jsx(se,{size:14})," Select All"]}),e.jsxs("button",{className:"btn btn-sm btn-secondary",onClick:U,title:"Sort by coverage %",children:[e.jsx(te,{size:14})," Coverage ",m==="coverage-asc"?"↑":m==="coverage-desc"?"↓":""]}),e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:H,disabled:C,children:[e.jsx(g,{size:14})," ",C?"Analyzing...":"AI Gap Analysis"]})]})]}),e.jsx("div",{className:"tabs",role:"tablist",children:["all","approved","review","flagged"].map(s=>e.jsx("button",{role:"tab",className:`tab ${y===s?"active":""}`,onClick:()=>P(s),"aria-selected":y===s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))}),e.jsx("div",{className:"req-list",role:"list",children:O.map(s=>e.jsxs("div",{className:`req-item ${w===s.id?"selected":""} ${c.includes(s.id)?"checked":""}`,role:"listitem",children:[e.jsx("div",{className:"req-check",children:e.jsx("input",{type:"checkbox",checked:c.includes(s.id),onChange:()=>J(s.id),"aria-label":`Select ${s.id}`})}),e.jsxs("div",{className:"req-body",onClick:()=>S(s.id),tabIndex:0,onKeyDown:a=>a.key==="Enter"&&S(s.id),children:[e.jsxs("div",{className:"req-header",children:[e.jsx("span",{className:"req-id",children:s.id}),e.jsxs("span",{className:`badge badge-${W(s.risk)}`,children:[s.risk," risk"]})]}),e.jsx("p",{className:"req-title",children:s.title}),e.jsxs("p",{className:"req-ai-summary",children:[e.jsx(g,{size:11})," ",s.aiSummary]}),e.jsxs("div",{className:"req-meta",children:[e.jsx("span",{className:`badge badge-${s.status==="approved"?"success":s.status==="flagged"?"danger":"warning"}`,children:s.status}),s.gaps>0?e.jsxs("button",{className:"req-stat gap-link",onClick:a=>{a.stopPropagation(),_(v===s.id?null:s.id)},children:[e.jsx(p,{size:12})," ",s.gaps," gaps ",v===s.id?e.jsx(I,{size:10}):e.jsx($,{size:10})]}):e.jsxs("span",{className:"req-stat",children:[e.jsx(M,{size:12,style:{color:"var(--success)"}})," 0 gaps"]}),e.jsxs("span",{className:"req-stat",children:[e.jsx(E,{size:12})," ",s.comments]}),e.jsxs("div",{className:"testability-bar",title:`Testability: ${s.testability}%`,children:[e.jsx("div",{className:"progress-bar",style:{width:"80px"},children:e.jsx("div",{className:"progress-fill",style:{width:`${s.testability}%`,background:s.testability>80?"var(--success)":s.testability>60?"var(--warning)":"var(--danger)"}})}),e.jsxs("span",{className:"testability-pct",children:[s.testability,"%"]})]})]}),v===s.id&&s.gapDetails.length>0&&e.jsxs("div",{className:"gap-details-panel animate-in",children:[e.jsxs("h5",{children:[e.jsx(p,{size:12})," Gap Details for ",s.id]}),e.jsx("ul",{children:s.gapDetails.map((a,i)=>e.jsx("li",{children:a},i))})]}),s.risk==="high"&&e.jsxs("div",{className:"risk-expand",children:[e.jsxs("button",{className:"risk-expand-btn",onClick:a=>{a.stopPropagation(),T(j===s.id?null:s.id)},children:[j===s.id?e.jsx(I,{size:12}):e.jsx($,{size:12})," Why high risk?"]}),j===s.id&&e.jsxs("div",{className:"risk-details animate-in",children:[e.jsxs("div",{className:"risk-driver",children:[e.jsx(X,{size:12})," Complexity: ",e.jsx("strong",{children:s.complexity})]}),e.jsxs("div",{className:"risk-driver",children:[e.jsx(Y,{size:12})," Untested branches: ",e.jsx("strong",{children:s.untestedBranches})]}),e.jsxs("div",{className:"risk-driver",children:[e.jsx(q,{size:12})," Edge cases: ",e.jsx("strong",{children:s.edgeCases})]}),e.jsxs("div",{className:"risk-driver",children:[e.jsx(re,{size:12})," Historical defects: ",e.jsx("strong",{children:s.historicalDefects})]})]}),e.jsxs("button",{className:"btn btn-sm btn-primary bridge-gap-btn",onClick:a=>{a.stopPropagation(),L(s)},style:{marginTop:"0.35rem"},children:[e.jsx(g,{size:12})," Bridge the Gap — Generate ",s.gaps," Missing Scenarios"]})]})]})]},s.id))})]}),e.jsxs("div",{className:"review-right-panels",children:[e.jsx("section",{className:"card review-detail-panel",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("h3",{className:"card-title",children:[l.id," Details"]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsxs("button",{className:"btn btn-sm btn-success",onClick:()=>t.success(`${l.id} approved`),children:[e.jsx(G,{size:14})," Approve"]}),e.jsxs("button",{className:"btn btn-sm btn-danger",onClick:()=>t.warning(`${l.id} rejected`),children:[e.jsx(de,{size:14})," Reject"]}),e.jsxs("button",{className:"btn btn-sm btn-secondary",onClick:()=>t.info(`${l.id} flagged for review`),children:[e.jsx(ae,{size:14})," Flag"]})]})]}),e.jsxs("div",{className:"detail-content",children:[e.jsxs("div",{className:"ai-insights",children:[e.jsxs("h4",{children:[e.jsx(g,{size:16})," AI Insights"]}),e.jsxs("div",{className:"insight-item warning",children:[e.jsx(p,{size:14}),e.jsx("span",{children:'Ambiguous: "gracefully" needs specific error handling criteria'})]}),e.jsxs("div",{className:"insight-item info",children:[e.jsx(B,{size:14}),e.jsx("span",{children:"Missing: No mention of offline recording behavior"})]}),e.jsxs("div",{className:"insight-item success",children:[e.jsx(M,{size:14}),e.jsx("span",{children:"Well-defined acceptance criteria for storage limits"})]})]}),e.jsxs("div",{className:"ai-explain",children:[e.jsxs("h4",{children:[e.jsx(g,{size:16})," AI Reasoning"]}),e.jsxs("div",{className:"explain-row",children:[e.jsx("span",{className:"explain-label",children:"Source:"}),e.jsxs("span",{children:[l.id," — ",l.title]})]}),e.jsxs("div",{className:"explain-row",children:[e.jsx("span",{className:"explain-label",children:"Logic:"}),e.jsx("span",{children:"Testability scored low due to vague acceptance criteria and missing boundary definitions"})]}),e.jsxs("div",{className:"explain-row",children:[e.jsx("span",{className:"explain-label",children:"Risk factors:"}),e.jsxs("span",{children:["Complexity (",l.complexity,"), ",l.untestedBranches," untested branches, ",l.edgeCases," edge cases"]})]}),e.jsxs("div",{className:"explain-row",children:[e.jsx("span",{className:"explain-label",children:"Assumptions:"}),e.jsx("span",{children:"Standard CDVR architecture, single-tenant storage model"})]})]}),e.jsxs("div",{className:"annotations",children:[e.jsx("h4",{children:"Annotations"}),e.jsxs("div",{className:"annotation",children:[e.jsx("strong",{children:"@sarah.chen"}),e.jsx("span",{className:"annotation-time",children:"2h ago"}),e.jsx("p",{children:"Need to clarify max concurrent recordings per account tier"})]}),e.jsxs("div",{className:"annotation",children:[e.jsx("strong",{children:"@mike.johnson"}),e.jsx("span",{className:"annotation-time",children:"1h ago"}),e.jsx("p",{children:"Edge case: What happens when recording overlaps with live pause?"})]}),e.jsx("div",{className:"annotation-input",children:e.jsx("input",{placeholder:"Add annotation... (use @ to mention)",onKeyDown:s=>{if(s.key==="Enter"&&s.target.value.trim()){const a=ee(s.target.value);a&&t.success(`Annotation added: "${a}"`),s.target.value=""}}})})]})]})]}):e.jsxs("div",{className:"empty-state",children:[e.jsx(B,{size:48}),e.jsx("p",{children:"Select a requirement to view details"})]})}),e.jsxs("section",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Coverage Radar"})}),e.jsxs("div",{className:"radar-chart",children:[e.jsxs("svg",{viewBox:"0 0 100 100",className:"radar-svg",children:[[20,40].map(s=>e.jsx("circle",{cx:"50",cy:"50",r:s,fill:"none",stroke:"var(--border)",strokeWidth:"0.3",strokeDasharray:"2"},s)),k.map(s=>{const a=(s.angle-90)*Math.PI/180;return e.jsx("line",{x1:"50",y1:"50",x2:50+42*Math.cos(a),y2:50+42*Math.sin(a),stroke:"var(--border)",strokeWidth:"0.2"},s.category)}),e.jsx("path",{d:Z,fill:"var(--accent-light)",stroke:"var(--accent)",strokeWidth:"0.5"}),R.map(s=>e.jsx("circle",{cx:s.cx,cy:s.cy,r:"1.5",fill:"var(--accent)"},s.category))]}),e.jsx("div",{className:"radar-labels",children:k.map(s=>{const a=(s.angle-90)*Math.PI/180,i=50+48*Math.cos(a),u=50+48*Math.sin(a);return e.jsxs("div",{className:"radar-label",style:{left:`${i}%`,top:`${u}%`},children:[e.jsx("span",{children:s.category}),e.jsxs("span",{className:`radar-pct ${s.coverage<40?"low":s.coverage<70?"mid":"high"}`,children:[s.coverage,"%"]})]},s.category)})})]}),e.jsxs("div",{className:"radar-alerts",children:[e.jsxs("div",{className:"radar-alert danger",children:[e.jsx(p,{size:12})," Security coverage critically low (28%)"]}),e.jsxs("div",{className:"radar-alert danger",children:[e.jsx(p,{size:12})," Edge case coverage below threshold (35%)"]}),e.jsxs("div",{className:"radar-alert warning",children:[e.jsx(p,{size:12})," Performance testing needs attention (42%)"]})]})]})]})]})]})}export{je as default};
